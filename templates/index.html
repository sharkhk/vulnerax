<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VulneraX Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
  <div class="p-4">
    <h1 class="text-2xl font-bold mb-4">VulneraX Dashboard</h1>
    <button id="loadDataBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">Load CVE Data</button>
    <div id="dataContainer" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </div>
  <script>
    async function loadCveData() {
      const btn = document.getElementById('loadDataBtn');
      btn.disabled = true;
      btn.textContent = 'Loading...';
      try {
        const res = await fetch('/api/cves');
        const data = await res.json();
        if (data.error) {
          alert('Error: ' + data.error);
        } else {
          renderCves(data.cves);
        }
      } catch (e) {
        alert('Fetch error: ' + e);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Load CVE Data';
      }
    }

    function renderCves(cves) {
      const container = document.getElementById('dataContainer');
      container.innerHTML = '';
      if (!Array.isArray(cves) || cves.length === 0) {
        container.textContent = 'No CVEs found.';
        return;
      }
      cves.forEach(c => {
        const id = c.id || 'Unknown ID';
        const pub = c.publishedDate;
        const date = pub ? pub.toString().slice(0,10) : 'Unknown date';
        const score = (c.cvssScore !== null && c.cvssScore !== undefined) ? c.cvssScore : 'N/A';
        const desc = c.description || '';
        const text = (typeof desc === 'string')
          ? (desc.length > 100 ? desc.slice(0, 100) + '...' : desc)
          : '';

        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-gray-800 p-4 rounded shadow';
        card.innerHTML = `
          <h2 class="font-bold mb-1">${id}</h2>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${date}</p>
          <p class="mb-2">Score: <strong>${score}</strong></p>
          <p class="text-gray-800 dark:text-gray-200">${text}</p>
        `;
        container.appendChild(card);
      });
    }

    document.getElementById('loadDataBtn').addEventListener('click', loadCveData);
  </script>
</body>
</html>
